# Steps to reproduce a crash due to an introduced bug in linux v5.11.10:

### 1. Clone linux repo
Make sure to checkout the **v5.11.10** tag inside the linux repo.

### 2. Make sure you use the appropiate config
```bash
cp ./syzkaller_blk_dev_dm.config /local/path/to/linux/.config
```
This config can be reproduced by executing the following commands using the syzkaller_kernelversion_lessthan_5.12.config at the root of this repo:
```bash
make defconfig
make kvm_guest.config
scripts/kconfig/merge_config.sh .config path/to/syzkaller_kernelversion_lessthan_5.12.config
scripts/kconfig/merge_config.sh .config path/to/blk_dev_dm.config
make olddefconfig
```

### 2. Get inside the docker container
```bash
docker compose up -d
docker exec -it build-linux-v5.9.x-environ bash
```

### 3. Compile kernel
Inside the docker container
```bash
cd linux
make -j8
```

Troubleshoot: 
`make distclean` can be useful to remove files from previous builds of other versions / in other environments

### 4. Run Syzkaller
Inside the syzkaller directory, run the follwoing command:
```bash
mkdir /path/to/workdir-cve-2021-31916
./bin/syz-manager -config /path/to/ctl_dm_calls.cfg  2>&1 | tee ./path/to/workdir-cve-2021-31916/log.log

```

Make sure to configure the paths in ctl_dm_calls.cfg correctly.